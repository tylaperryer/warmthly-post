<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="theme-color" content="#fff6f1" />
  <meta name="color-scheme" content="light" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Post - Warmthly</title>
  <link rel="preconnect" href="https://www.warmthly.org">
  <link rel="preconnect" href="https://post.warmthly.org">
  
  <!-- Favicon Set for All Devices -->
  <link rel="icon" type="image/png" sizes="32x32" href="/candle-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/candle-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/candle-apple.png">
  <style>
      /* --- ANTI-FLASH AND PERFORMANCE FIXES --- */
      :root { color-scheme: light; }
      html { background-color: #fff6f1; min-height: 100%; overflow-x: hidden; overflow-y: auto; scrollbar-width: none; -ms-overflow-style: none; }
      html::-webkit-scrollbar { display: none; width: 0; height: 0; }
      body { opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out; }
      body.fonts-loaded { opacity: 1; visibility: visible; }
      /* --- END ANTI-FLASH FIXES --- */
      

      * { margin: 0; padding: 0; box-sizing: border-box; }
      @font-face { font-family: 'Cormorant Garamond'; font-style: normal; font-weight: 300 700; font-display: swap; src: url('/fonts/CormorantGaramond-VariableFont_wght.ttf') format('truetype'); }
      @font-face { font-family: 'Cormorant Garamond'; font-style: italic; font-weight: 300 700; font-display: swap; src: url('/fonts/CormorantGaramond-Italic-VariableFont_wght.ttf') format('truetype'); }
      @font-face { font-family: 'Inter'; font-style: normal; font-weight: 100 900; font-display: swap; src: url('/fonts/Inter-VariableFont_opsz,wght.ttf') format('truetype'); }
      @font-face { font-family: 'Inter'; font-style: italic; font-weight: 100 900; font-display: swap; src: url('/fonts/Inter-Italic-VariableFont_opsz,wght.ttf') format('truetype'); }
      
      body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #2c2c2c; background: #fff6f1; min-height: 100vh; position: relative; overflow-x: hidden; overflow-y: auto; scrollbar-width: none; -ms-overflow-style: none; }
      body::-webkit-scrollbar { display: none; }
      
      /* Refined background with subtle gradient sophistication */
      body::before {
        content: '';
        position: fixed;
        inset: 0;
        background: #fff6f1;
        background-image: 
          radial-gradient(circle at 20% 30%, rgba(255,140,66,0.08) 0%, transparent 40%),
          radial-gradient(circle at 80% 80%, rgba(255,182,193,0.06) 0%, transparent 50%),
          linear-gradient(180deg, rgba(255,251,247,0.4) 0%, transparent 50%);
        background-attachment: fixed;
        pointer-events: none;
        z-index: -1;
      }
      
      /* Make sure images/icons never cause reflows */
      img, svg { display: block; max-width: 100%; }
      
      /* Fix layout shift when popup opens */
      body.popup-open {
        overflow: hidden;
      }
      
      ::selection { background: #FF8C42; color: #FFFFFF; }
      
      .container { max-width: 1200px; margin: 0 auto; padding: 160px 32px 80px; text-align: center; color: #2c2c2c; position: relative; z-index: 1; }
      
      .top-left-heading { position: fixed; top: 24px; left: 24px; font-family: 'Cormorant Garamond', Georgia, serif; font-weight: 700; font-size: 2rem; color: #FF8C42; user-select: none; z-index: 1001; letter-spacing: -0.01em; }
      .top-left-heading .warmthly-link { text-decoration: none; color: #FF8C42; }
      .top-left-heading .post-text { color: #ff4757; text-decoration: none; transition: color 0.3s ease; }
      .top-left-heading .post-text:hover { color: #ee3542; }
      
      .stoplight-container { position: relative; z-index: 1002; }
      .stoplight { --tint-color: rgba(255,255,255,0.15); --blur-radius: 12px; --border-color: rgba(255,255,255,0.25); --highlight-color: rgba(255,255,255,0.4); --shadow-color: rgba(0,0,0,0.08); display: flex; flex-direction: column; gap: 3px; cursor: pointer; padding: 8px; position: relative; background: var(--tint-color); backdrop-filter: blur(var(--blur-radius)) saturate(1.2); -webkit-backdrop-filter: blur(var(--blur-radius)) saturate(1.2); border: 1px solid var(--border-color); border-radius: 14px; box-shadow: 0 6px 12px var(--shadow-color), inset 0 1px 1px var(--highlight-color), inset 0 -1px 1px rgba(0,0,0,0.05); transition: all 0.4s cubic-bezier(0.25,0.8,0.25,1); overflow: hidden; }
      .stoplight::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: inherit; background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%); pointer-events: none; z-index: 1; opacity: 0.7; transition: opacity 0.4s cubic-bezier(0.25,0.8,0.25,1); }
      .stoplight:hover,
      .stoplight.active { background: rgba(255,255,255,0.25); box-shadow: 0 8px 16px rgba(0,0,0,0.12), inset 0 1px 1px rgba(255,255,255,0.5), inset 0 -1px 1px rgba(0,0,0,0.1); }
      .stoplight:hover::before,
      .stoplight.active::before { opacity: 1; }
      .stoplight-dot { width: 8px; height: 8px; border-radius: 50%; position: relative; transition: opacity 0.4s cubic-bezier(0.25,0.8,0.25,1); z-index: 2; opacity: 0.3; }
      .stoplight-dot.red { background: #ff4757; }
      .stoplight-dot.yellow { background: #FF8C42; }
      .stoplight-dot.green { background: #2ed573; }
      .stoplight-container:hover .stoplight-dot.red,
      .stoplight.active .stoplight-dot.red { animation: stoplight-cycle-red 10s cubic-bezier(0.25,0.8,0.25,1) infinite; }
      .stoplight-container:hover .stoplight-dot.green,
      .stoplight.active .stoplight-dot.green { animation: stoplight-cycle-green 10s cubic-bezier(0.25,0.8,0.25,1) infinite; }
      .stoplight-container:hover .stoplight-dot.yellow,
      .stoplight.active .stoplight-dot.yellow { animation: stoplight-cycle-yellow 10s cubic-bezier(0.25,0.8,0.25,1) infinite; }
      @keyframes stoplight-cycle-red { 0%, 33.33% { opacity: 1; } 33.34%, 100% { opacity: 0.3; } }
      @keyframes stoplight-cycle-green { 0%, 33.33% { opacity: 0.3; } 33.34%, 66.66% { opacity: 1; } 66.67%, 100% { opacity: 0.3; } }
      @keyframes stoplight-cycle-yellow { 0%, 66.66% { opacity: 0.3; } 66.67%, 100% { opacity: 1; } }
      .dropdown-menu { --tint-color: rgba(255,255,255,0.15); --blur-radius: 12px; --border-color: rgba(255,255,255,0.25); --highlight-color: rgba(255,255,255,0.4); --shadow-color: rgba(0,0,0,0.08); --text-color: #1c2526; position: absolute; top: 100%; right: 0; background: var(--tint-color); backdrop-filter: blur(var(--blur-radius)) saturate(1.2); -webkit-backdrop-filter: blur(var(--blur-radius)) saturate(1.2); border-radius: 18px; padding: 8px; margin-top: 12px; min-width: 200px; box-shadow: 0 8px 32px var(--shadow-color), inset 0 1px 1px var(--highlight-color), inset 0 -1px 1px rgba(0,0,0,0.05); border: 1px solid var(--border-color); opacity: 0; visibility: hidden; transform: translateY(-12px) scale(0.94); transition: all 0.4s cubic-bezier(0.4,0,0.2,1); overflow: hidden; }
      .dropdown-menu::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: inherit; background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%); pointer-events: none; z-index: 1; opacity: 0.7; }
      .dropdown-menu.active { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }
      .dropdown-item { display: block; padding: 12px 16px; margin: 2px 0; color: var(--text-color); text-decoration: none; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; font-weight: 500; font-size: 0.95rem; transition: all 0.3s cubic-bezier(0.25,0.8,0.25,1); border-radius: 10px; position: relative; z-index: 2; }
      .dropdown-item:hover { color: #FF8C42; }
      .dropdown-item:first-child { margin-top: 0; }
      .dropdown-item:last-child { margin-bottom: 0; }
      
      .hero-section { margin-bottom: 8rem; }
      .page-title { font-family: 'Inter', sans-serif; font-size: 4rem; color: #FF8C42; margin-bottom: 2rem; font-weight: 600; text-align: center; letter-spacing: -0.04em; line-height: 1.1; }
      .subtitle { font-family: 'Inter', sans-serif; font-size: 1.25rem; color: #2c2c2c; opacity: 0.7; margin-bottom: 6rem; line-height: 1.75; text-align: center; max-width: 680px; margin-left: auto; margin-right: auto; font-weight: 400; }
      
      .section { background: linear-gradient(135deg, rgba(255,255,255,0.5), rgba(255,255,255,0.15)); padding: 3.5rem; border-radius: 28px; border: 1px solid rgba(255,140,66,0.12); margin: 4rem 0; text-align: left; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 4px 24px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.02); }
      .section-title { font-family: 'Inter', sans-serif; font-size: 2rem; color: #FF8C42; margin-bottom: 2rem; font-weight: 600; text-align: center; letter-spacing: -0.02em; }
      .section p { opacity: 0.7; line-height: 1.85; margin-bottom: 1.25rem; font-weight: 400; }
      .section strong { font-weight: 600; color: #1a1a1a; }
      
      
      .header-right {
            position: fixed;
            top: 24px;
            right: 24px;
            display: flex;
            align-items: center;
            gap: 24px;
            z-index: 1001;
            pointer-events: auto;
      }
      
      .nav-link {
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            color: #FF8C42;
            text-decoration: none;
            font-size: 0.95rem;
            user-select: none;
            transition: color 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.01em;
      }
      
      .nav-link:hover {
            color: #e07a35;
      }
      
      .nav-link.nav-link-red {
            color: #ff4757;
      }
      
      .nav-link.nav-link-red:hover {
            color: #ee3542;
      }
      
      .info-box { background: rgba(255,140,66,0.08); border-left: 4px solid #FF8C42; padding: 1.5rem; border-radius: 8px; margin: 2rem 0; }
      .info-box p { margin: 0; opacity: 0.9; }
      
      /* --- TIMELINE LINE --- */
      .timeline-line {
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 1.5px;
        background: linear-gradient(
          to bottom,
          rgba(255, 140, 66, 0.15) 0%,
          rgba(255, 140, 66, 0.3) 20%,
          rgba(255, 140, 66, 0.3) 80%,
          rgba(255, 140, 66, 0.15) 100%
        );
        transform: translateX(-50%);
        z-index: 0;
        pointer-events: none;
        will-change: transform;
      }
      
      .timeline-wrapper {
        position: relative;
        min-height: 100vh;
      }
      
      /* --- TIMELINE CONTAINER --- */
      .timeline-container {
        position: relative;
        max-width: 1000px;
        margin: 6rem auto;
        padding: 0 32px;
      }
      
      .timeline-entry {
        position: relative;
        margin: 8rem 0;
        display: flex;
        align-items: center;
        min-height: 140px;
      }
      
      .timeline-entry:nth-child(even) {
        flex-direction: row-reverse;
      }
      
      /* Perfectly centered timeline dot ‚Äì always on the intersection */
      .timeline-marker {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%) translateZ(0);
        -webkit-transform: translate(-50%, -50%) translateZ(0);
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #FF8C42;
        border: 3px solid #fff6f1;
        box-shadow: 
          0 2px 8px rgba(0,0,0,0.12),
          0 0 0 1px rgba(255,140,66,0.15);
        z-index: 10;
        pointer-events: none;
      }
      
      /* Colour classes */
      .timeline-marker.orange { background: #FF8C42; }
      .timeline-marker.green { background: #2ed573; }
      .timeline-marker.red { background: #ff4757; }
      .timeline-marker.blue { background: #5f27cd; }
      
      /* Summary Card */
      .timeline-card {
        width: calc(50% - 48px);
        background: linear-gradient(135deg, rgba(255,255,255,0.5), rgba(255,255,255,0.15));
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 20px;
        padding: 2rem 2rem 2rem 2rem;
        border: 1px solid rgba(255,140,66,0.12);
        box-shadow: 0 4px 24px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.02);
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        z-index: 5;
        transform: translateZ(0) scale(1);
        -webkit-transform: translateZ(0) scale(1);
      }
      
      .timeline-card:hover {
        transform: translateY(-2px) scale(1.01);
        box-shadow: 0 8px 32px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.04);
        border-color: rgba(255,140,66,0.25);
      }
      
      .timeline-card-date {
        font-family: 'Inter', sans-serif;
        font-size: 0.8rem;
        color: #FF8C42;
        font-weight: 500;
        margin-bottom: 0.75rem;
        opacity: 0.7;
        letter-spacing: 0.02em;
        text-transform: uppercase;
      }
      
      .timeline-card-title {
        font-family: 'Inter', sans-serif;
        font-size: 1.5rem;
        color: #1a1a1a;
        font-weight: 600;
        margin-bottom: 1rem;
        line-height: 1.2;
        letter-spacing: -0.02em;
      }
      
      .timeline-card-description {
        font-family: 'Inter', sans-serif;
        font-size: 0.95rem;
        color: #2c2c2c;
        opacity: 0.65;
        line-height: 1.7;
        font-weight: 400;
      }
      
      .timeline-card-read-more {
        font-family: 'Inter', sans-serif;
        font-size: 0.85rem;
        color: #FF8C42;
        font-weight: 500;
        margin-top: 1rem;
        display: inline-block;
        opacity: 0.6;
        transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        letter-spacing: 0.01em;
      }
      
      .timeline-card:hover .timeline-card-read-more {
        opacity: 1;
      }
      
      /* Connecting Line from Marker to Card - Make the horizontal line touch the dot perfectly */
      .timeline-connector {
        position: absolute;
        top: 50%;
        height: 1.5px;
        transform: translateY(-50%);
        z-index: 1;
        pointer-events: none;
      }
      
      /* Odd entries (left ‚Üí right) - connector starts from right edge of marker */
      .timeline-entry:nth-child(odd) .timeline-connector {
        left: calc(50% + 9px);
        width: calc(50% - 57px);
        background: linear-gradient(to right, rgba(255, 140, 66, 0.25), transparent);
      }
      
      /* Even entries (right ‚Üí left) - connector starts from left edge of marker */
      .timeline-entry:nth-child(even) .timeline-connector {
        right: calc(50% - 9px);
        width: calc(50% - 57px);
        background: linear-gradient(to left, rgba(255, 140, 66, 0.25), transparent);
      }
      
      /* Book Emoji Cards ‚Äì now placed on the horizontal connector instead of the vertical line */
      .timeline-books {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: row;
        gap: 0;
        align-items: center;
        z-index: 15;
        pointer-events: none;
      }
      
      /* Left side entries (odd) ‚Üí books go to the right of the marker */
      .timeline-entry:nth-child(odd) .timeline-books {
        left: calc(50% + 20px);
      }
      
      /* Right side entries (even) ‚Üí books go to the left of the marker */
      .timeline-entry:nth-child(even) .timeline-books {
        right: calc(50% + 20px);
        flex-direction: row-reverse;
      }
      
      .book-card {
        cursor: pointer;
        transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        font-size: 1.5rem;
        line-height: 1;
        pointer-events: auto;
        margin: 0 6px;
        transform: translateZ(0) scale(1);
        -webkit-transform: translateZ(0) scale(1);
      }
      
      .book-card:hover {
        transform: scale(1.25);
      }
      
      /* Book Hover Popup */
      .book-popup {
        position: absolute;
        background: rgba(255,255,255,0.15);
        backdrop-filter: blur(20px) saturate(1.2);
        -webkit-backdrop-filter: blur(20px) saturate(1.2);
        border-radius: 12px;
        padding: 1rem;
        border: 1px solid rgba(255,255,255,0.25);
        box-shadow: 0 8px 32px rgba(0,0,0,0.12), inset 0 1px 1px rgba(255,255,255,0.4);
        z-index: 100;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px) scale(0.9);
        transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
        pointer-events: none;
        min-width: 200px;
        max-width: 280px;
        font-family: 'Inter', sans-serif;
        font-size: 0.85rem;
        color: #2c2c2c;
        line-height: 1.6;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      .book-popup::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: inherit;
        background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
        pointer-events: none;
        z-index: -1;
        opacity: 0.7;
      }
      
      .book-card:hover .book-popup,
      .book-popup:hover {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
        pointer-events: auto;
      }
      
      .book-popup-heading {
        font-weight: 600;
        color: #FF8C42;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        line-height: 1.3;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        cursor: text;
        user-select: text;
      }
      
      .book-popup-description {
        opacity: 0.85;
        font-size: 0.8rem;
        line-height: 1.5;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        cursor: text;
        user-select: text;
      }
      
      /* Position book popups - appear above the emoji */
      .timeline-books .book-card .book-popup {
        bottom: calc(100% + 0.75rem);
        left: 50%;
        transform: translateX(-50%) translateY(10px) scale(0.9);
      }
      
      .timeline-books .book-card:hover .book-popup,
      .timeline-books .book-popup:hover {
        transform: translateX(-50%) translateY(0) scale(1);
      }
      
      /* Adjust popup position for even entries (right side) */
      .timeline-entry:nth-child(even) .timeline-books .book-card .book-popup {
        left: 50%;
        right: auto;
      }
      
      /* SUPER SMOOTH & CRISP POPUP ‚Äì works perfectly on phones */
      .chronicle-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.96);
        background: rgba(255, 251, 247, 0.98);
        border: 1px solid rgba(255, 140, 66, 0.2);
        border-radius: 28px;
        padding: 3rem 2.5rem 2.5rem;
        max-width: 680px;
        width: calc(100% - 48px);
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0,0,0,0.12), 0 4px 12px rgba(0,0,0,0.08);
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
        backdrop-filter: none !important;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
      .chronicle-popup::-webkit-scrollbar {
        display: none;
        width: 0;
        height: 0;
      }
      
      .chronicle-popup::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 24px;
        background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(255,255,255,0.05));
        pointer-events: none;
        z-index: -1;
      }
      
      .chronicle-popup.active {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1);
      }
      
      
      .chronicle-popup-header {
        font-family: 'Inter', sans-serif;
        font-size: 0.8rem;
        color: #FF8C42;
        font-weight: 500;
        margin-bottom: 0.75rem;
        opacity: 0.7;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        letter-spacing: 0.02em;
        text-transform: uppercase;
      }
      
      .chronicle-popup-title {
        font-family: 'Inter', sans-serif;
        font-size: 2rem;
        color: #1a1a1a;
        font-weight: 600;
        margin-bottom: 2rem;
        line-height: 1.2;
        letter-spacing: -0.03em;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      .chronicle-popup-content {
        font-family: 'Inter', sans-serif;
        font-size: 1.05rem;
        color: #2c2c2c;
        line-height: 1.85;
        opacity: 0.7;
        font-weight: 400;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      .chronicle-popup-content p {
        margin-bottom: 1.5rem;
      }
      
      .chronicle-popup-content p:last-child {
        margin-bottom: 0;
      }
      
      .chronicle-popup-content a {
        color: #FF8C42;
        text-decoration: none;
        font-weight: 600;
        transition: color 0.3s ease;
      }
      
      .chronicle-popup-content a:hover {
        color: #e07a35;
      }
      
      .chronicle-popup-close {
        position: absolute;
        top: 1.25rem;
        right: 1.25rem;
        width: 36px;
        height: 36px;
        border: none;
        background: rgba(255,255,255,0.3);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        color: #2c2c2c;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10;
        opacity: 0.7;
      }
      
      .chronicle-popup-close:hover {
        background: rgba(255,255,255,0.4);
        transform: scale(1.05);
        opacity: 1;
      }
      
      .chronicle-popup-close:active {
        transform: scale(0.98);
      }
      
      /* Accessibility ‚Äì focus outlines for keyboard users */
      .timeline-card:focus-visible,
      .book-card:focus-visible,
      .chronicle-popup-close:focus-visible,
      .stoplight:focus-visible {
        outline: 2px solid #FF8C42;
        outline-offset: 3px;
        border-radius: 4px;
      }
      
      /* World Map Heatmap */
      .world-map-container {
        width: 100%;
        max-width: 100%;
        margin: 3rem auto;
        padding: 0 2rem;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .world-map-svg {
        width: 100%;
        max-width: 600px;
        min-height: 200px;
        height: auto;
        display: block;
      }
      
      .world-map-svg svg {
        width: 100%;
        height: auto;
        display: block;
      }
      
      /* Default dot state - dimmed/inactive (for emoji text elements) */
      .world-map-svg svg text {
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: default;
        pointer-events: none;
        opacity: 0.3;
        user-select: none;
        font-family: Arial, sans-serif;
        font-size: 40px;
        text-anchor: middle;
        dominant-baseline: central;
      }
      
      /* Heatmap intensity levels for emoji */
      .world-map-svg svg text.intensity-0 {
        opacity: 0.3;
        filter: brightness(0.8);
      }
      
      .world-map-svg svg text.intensity-1 {
        opacity: 0.5;
        filter: brightness(1.2);
      }
      
      .world-map-svg svg text.intensity-2 {
        opacity: 0.7;
        filter: brightness(1.4);
      }
      
      .world-map-svg svg text.intensity-3 {
        opacity: 0.85;
        filter: brightness(1.6);
      }
      
      .world-map-svg svg text.intensity-4 {
        opacity: 1;
        filter: brightness(1.8) drop-shadow(0 0 8px rgba(255, 223, 0, 0.8));
        animation: pulse-emoji 2s ease-in-out infinite;
      }
      
      @keyframes pulse-emoji {
        0%, 100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
      }
      
      @media (max-width: 768px) {
            .container { padding-top: 100px; padding-left: 20px; padding-right: 20px; }
            .top-left-heading { font-size: 1.6rem; top: 20px; left: 20px; }
            .header-right { top: 20px; right: 20px; gap: 16px; }
            .nav-link { font-size: 0.9rem; }
            .stoplight-container { top: 20px; right: 20px; }
            .page-title { font-size: 2.75rem; letter-spacing: -0.03em; }
            .subtitle { font-size: 1.1rem; margin-bottom: 5rem; }
            .hero-section { margin-bottom: 6rem; }
            .section { padding: 2.5rem 2rem; margin: 3rem 0; }
            .section-title { font-size: 1.75rem; }
            
            .timeline-container { padding: 0 20px; margin: 5rem auto; }
            .timeline-entry { flex-direction: column !important; margin: 6rem 0; }
            .timeline-card { width: calc(100% - 40px); margin-left: 0 !important; margin-right: 0 !important; padding: 2rem 1.75rem; }
            .timeline-books { position: relative !important; left: auto !important; right: auto !important; top: auto !important; transform: none !important; flex-direction: row !important; flex-wrap: wrap; gap: 0.5rem; margin: 1.5rem 0; justify-content: center; }
            .timeline-connector { display: none; }
            .timeline-marker { position: relative; left: auto; transform: none; margin: 1.5rem auto; }
            .chronicle-popup { padding: 2rem 1.75rem; max-width: 95%; }
            .chronicle-popup-title { font-size: 1.75rem; }
            
            .world-map-container { padding: 0 1rem; margin: 2rem auto; }
      }
  </style>
  
</head>
<body class="fonts-loading">
    <div class="top-left-heading">
      <a href="https://www.warmthly.org" class="warmthly-link">Warmthly</a>
      <a href="https://post.warmthly.org" class="post-text">Post</a>
    </div>
    
    <nav class="header-right" role="navigation" aria-label="Main navigation">
      <a href="https://post.warmthly.org/report" class="nav-link nav-link-red" aria-label="Report an issue">Report</a>
      <a href="https://post.warmthly.org/vote" class="nav-link" aria-label="View the dissolution vote">Dissolution</a>
      <div class="stoplight-container">
        <div class="stoplight" id="stoplight">
          <div class="stoplight-dot red"></div>
          <div class="stoplight-dot yellow"></div>
          <div class="stoplight-dot green"></div>
        </div>
        <div class="dropdown-menu" id="dropdown-menu">
          <a href="https://www.warmthly.org" class="dropdown-item">Home</a>
          <a href="https://mint.warmthly.org" class="dropdown-item">Mint</a>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="hero-section">
        <h1 class="page-title">Post</h1>
        <p class="subtitle">
          A living timeline of our organization's story‚Äîfrom founding moments to future plans. Every decision, milestone, and community interaction is recorded here for complete transparency.
        </p>
      </div>
      
      <!-- World Map Heatmap -->
      <div class="world-map-container">
        <div class="world-map-svg" id="worldMapSvg">
          <!-- SVG will be loaded from worlddots.svg by JavaScript -->
        </div>
      </div>
      
      <!-- Timeline Wrapper with Line -->
      <div class="timeline-wrapper">
        <div class="timeline-line" aria-hidden="true"></div>
        
        <!-- Timeline Container -->
        <div class="timeline-container" id="timeline-container">
          <!-- Timeline entries will be added here -->
        </div>
      </div>
    </div>
    
    <!-- Chronicle Popup -->
    <div class="chronicle-popup" id="chronicle-popup">
      <button class="chronicle-popup-close" id="popup-close" aria-label="Close popup">√ó</button>
      <div class="chronicle-popup-header" id="popup-date"></div>
      <h2 class="chronicle-popup-title" id="popup-title"></h2>
      <div class="chronicle-popup-content" id="popup-content"></div>
    </div>

  <script>
    // --- NATIVE FONT LOADING ---
    if (document.fonts && document.fonts.ready) {
      document.fonts.ready.then(() => {
        document.body.classList.remove('fonts-loading');
        document.body.classList.add('fonts-loaded');
      });
      
      // Fallback timeout
      setTimeout(() => {
        document.body.classList.remove('fonts-loading');
        document.body.classList.add('fonts-loaded');
      }, 3000);
    } else {
      // Fallback for older browsers
      document.body.classList.remove('fonts-loading');
      document.body.classList.add('fonts-loaded');
    }
    // --- END FONT LOADING ---

    // Stoplight menu functionality
    const stoplight = document.getElementById('stoplight');
    const dropdownMenu = document.getElementById('dropdown-menu');
    let isMenuOpen = false;
    
    function toggleMenu() {
      isMenuOpen = !isMenuOpen;
      stoplight.classList.toggle('active', isMenuOpen);
      dropdownMenu.classList.toggle('active', isMenuOpen);
      stoplight.setAttribute('aria-expanded', isMenuOpen ? 'true' : 'false');
    }
    
    // Add keyboard support for stoplight
    stoplight.setAttribute('role', 'button');
    stoplight.setAttribute('tabindex', '0');
    stoplight.setAttribute('aria-label', 'Open navigation menu');
    stoplight.setAttribute('aria-expanded', 'false');
    stoplight.setAttribute('aria-haspopup', 'true');
    
    stoplight.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMenu();
    });
    
    stoplight.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ' || e.key === 'ArrowDown') {
        e.preventDefault();
        toggleMenu();
      }
    });
    
    document.addEventListener('click', (e) => {
      if (!stoplight.contains(e.target) && !dropdownMenu.contains(e.target) && isMenuOpen) {
        toggleMenu();
      }
    });
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isMenuOpen) {
        toggleMenu();
      }
    });
    
    dropdownMenu.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    
    // --- TIMELINE FUNCTIONALITY ---
    const bookEmojis = ['üìï', 'üìî', 'üìó', 'üìò', 'üìô', 'üìë', 'üßæ', 'üîñ'];
    
    function getRandomBookEmoji() {
      return bookEmojis[Math.floor(Math.random() * bookEmojis.length)];
    }
    
    const timelineData = [
      {
        date: 'November 15, 2025',
        title: 'Warmthly is Founded',
        description: 'The organization is established with a mission to bring warmth and transparency to the world.',
        marker: 'orange',
        signature: true,
        content: `
          <p>Warmthly was founded on the principle that organizations should operate with complete transparency and genuine care for their communities. Our mission is to bring warmth‚Äîboth literal and metaphorical‚Äîto those who need it most.</p>
          <p>The story of Warmthly begins with "Tyla," a concept that represents our core philosophy: every action should be taken with intention, every decision should be made with the community in mind, and every resource should be used to create genuine value.</p>
          <p>From day one, we committed to radical transparency. This means opening our books, sharing our decision-making process, and creating spaces where community voices are not just heard, but actively shape our direction.</p>
        `,
        comments: [
          { heading: 'Mission statement finalized', description: 'Core values of transparency and community care established as foundation.' },
          { heading: 'Initial team assembled', description: 'Three founding members committed to radical transparency from day one.' },
          { heading: 'First community outreach', description: 'Reached out to local organizations to understand community needs.' }
        ]
      },
      {
        date: 'November 27, 2025',
        title: 'The Mint Initiative is Launched',
        description: 'We launch our transparent financial tracking system, making every expense visible to the public.',
        marker: 'green',
        content: `
          <p>The Mint page represents a fundamental shift in how organizations handle financial transparency. Every expense, every receipt, every financial decision is made public in real-time.</p>
          <p>This initiative allows anyone to see exactly how Warmthly uses its resources. We believe that financial transparency is not just about accountability‚Äîit's about building trust and demonstrating that we take our responsibility to donors and the community seriously.</p>
          <p><a href="https://mint.warmthly.org" target="_blank">Visit the Mint page ‚Üí</a></p>
        `,
        comments: [
          { heading: '10% improved cost efficiency', description: 'Streamlined expense tracking reduced administrative overhead significantly.' },
          { heading: 'Real-time transparency achieved', description: 'All financial data now visible to public within 24 hours of transaction.' },
          { heading: 'Donor trust increased', description: 'Complete visibility into fund usage boosted donor confidence by 40%.' }
        ]
      },
      {
        date: 'December 1, 2025',
        title: 'The Dissolution Vote: Our Ultimate Promise',
        description: 'We establish the dissolution mechanism as a core, foundational principle of the organization.',
        marker: 'red',
        content: `
          <p>The dissolution vote is Warmthly's ultimate promise to the community: if we ever lose our way, if we stop serving our mission, or if the community determines we're no longer needed, we will dissolve.</p>
          <p>This mechanism ensures that Warmthly can never become an organization that exists for its own sake. We are here to serve a purpose, and if that purpose is no longer being fulfilled, we will step aside.</p>
          <p>The vote is accessible to all community members and requires a transparent, democratic process. This is not just a safety mechanism‚Äîit's a commitment to staying true to our values, no matter what.</p>
          <p><a href="https://post.warmthly.org/vote" target="_blank">Learn more about the dissolution vote ‚Üí</a></p>
        `,
        comments: [
          { heading: 'Dissolution mechanism designed', description: 'Community voting system created to ensure organizational accountability.' },
          { heading: 'Voting platform launched', description: 'Public voting interface made accessible for all community members.' },
          { heading: 'First accountability review', description: 'Quarterly review process established to evaluate mission alignment.' }
        ]
      },
      {
        date: 'December 10, 2025',
        title: 'Project: Clipboard Liaison Begins',
        description: 'We launch our first community project focused on bridging gaps in local communication.',
        marker: 'green',
        content: `
          <p>The Clipboard Liaison project addresses a critical gap in community communication. Many important local announcements, resources, and opportunities are shared on physical bulletin boards, community centers, and local gathering places‚Äîbut these don't always reach everyone who needs them.</p>
          <p>Our project creates a network of volunteers who regularly check these physical spaces, digitize important information, and make it accessible online. This ensures that community members who can't physically visit these locations still have access to vital information.</p>
          <p>The project is currently in its pilot phase, working with three local communities to test the model and refine our approach. Initial feedback has been overwhelmingly positive, with community members reporting increased access to resources and opportunities.</p>
          <p><a href="https://mint.warmthly.org" target="_blank">View project expenses on Mint ‚Üí</a></p>
        `,
        comments: [
          { heading: 'We made the clipboard liaison today', description: 'Launched pilot program in three local communities to digitize physical bulletin boards.' },
          { heading: 'First volunteer team recruited', description: 'Five volunteers signed up to help with weekly bulletin board checks.' },
          { heading: 'Initial success metrics', description: 'Over 50 community resources digitized in first month of operation.' }
        ]
      },
      {
        date: 'January 1, 2026',
        title: 'Community Report: Q4 2025',
        description: 'We publish our first quarterly community report, sharing anonymized feedback and actions taken.',
        marker: 'red',
        content: `
          <p>Transparency means not just sharing what goes right, but also being open about challenges and how we address them. This quarterly report summarizes all community feedback received through our reporting system.</p>
          <p><strong>Reports Received:</strong> 12</p>
          <p><strong>Categories:</strong></p>
          <ul>
            <li>Website accessibility concerns: 4</li>
            <li>Suggestions for new features: 5</li>
            <li>Questions about financial transparency: 2</li>
            <li>General feedback: 1</li>
          </ul>
          <p><strong>Actions Taken:</strong></p>
          <ul>
            <li>Improved mobile responsiveness based on accessibility feedback</li>
            <li>Added FAQ section addressing common questions</li>
            <li>Enhanced financial reporting with more detailed categories</li>
            <li>Implemented three feature suggestions from the community</li>
          </ul>
          <p>We're committed to responding to every report and taking action when appropriate. Your voice matters, and this report is our way of showing that we're listening.</p>
        `,
        comments: [
          { heading: 'Mobile accessibility improved', description: 'Enhanced responsive design based on community feedback received.' },
          { heading: 'Three features implemented', description: 'Community-suggested features now live: dark mode, search, and export.' },
          { heading: 'Response time reduced', description: 'Average response to community reports now under 48 hours.' }
        ]
      }
    ];
    
    const timelineContainer = document.getElementById('timeline-container');
    const popup = document.getElementById('chronicle-popup');
    const popupClose = document.getElementById('popup-close');
    const popupDate = document.getElementById('popup-date');
    const popupTitle = document.getElementById('popup-title');
    const popupContent = document.getElementById('popup-content');
    
    // Create timeline entries
    timelineData.forEach((entry, index) => {
      const entryElement = document.createElement('div');
      entryElement.className = 'timeline-entry';
      entryElement.setAttribute('data-index', index);
      
      // Create book cards HTML
      const booksHTML = entry.comments ? entry.comments.map(comment => {
        const emoji = getRandomBookEmoji();
        return `
          <div class="book-card">
            ${emoji}
            <div class="book-popup">
              <div class="book-popup-heading">${comment.heading}</div>
              <div class="book-popup-description">${comment.description}</div>
            </div>
          </div>
        `;
      }).join('') : '';
      
      entryElement.innerHTML = `
        <div class="timeline-connector"></div>
        <div class="timeline-marker ${entry.marker}" aria-label="Timeline marker"></div>
        <div class="timeline-card">
          <div class="timeline-card-date">${entry.date}</div>
          <h3 class="timeline-card-title">${entry.title}</h3>
          <p class="timeline-card-description">${entry.description}</p>
          <span class="timeline-card-read-more">Read more ‚Üí</span>
        </div>
        ${entry.comments ? `<div class="timeline-books">${booksHTML}</div>` : ''}
      `;
      
      const card = entryElement.querySelector('.timeline-card');
      card.addEventListener('click', () => openPopup(entry));
      
      // Add signature only to the founding card
      if (entry.signature) {
        const sig = document.createElement('img');
        sig.src = '/signature.png';
        sig.alt = "Founder's handwritten signature";
        sig.style.cssText = `
          max-height: 120px;
          margin: 1.5rem auto 0;
          display: block;
          opacity: 0.85;
          filter: brightness(1.1);
        `;
        entryElement.querySelector('.timeline-card').appendChild(sig);
      }
      
      // Add hover delay functionality to book cards
      const bookCards = entryElement.querySelectorAll('.book-card');
      const isEven = index % 2 === 1; // nth-child is 1-indexed, so even entries are odd indices
      
      bookCards.forEach(bookCard => {
        const bookPopup = bookCard.querySelector('.book-popup');
        let hideTimeout;
        
        const showPopup = () => {
          clearTimeout(hideTimeout);
          bookPopup.style.opacity = '1';
          bookPopup.style.visibility = 'visible';
          if (isEven) {
            bookPopup.style.transform = 'translateY(0) scale(1)';
          } else {
            bookPopup.style.transform = 'translateX(-50%) translateY(0) scale(1)';
          }
          bookPopup.style.pointerEvents = 'auto';
        };
        
        const hidePopup = () => {
          hideTimeout = setTimeout(() => {
            bookPopup.style.opacity = '0';
            bookPopup.style.visibility = 'hidden';
            if (isEven) {
              bookPopup.style.transform = 'translateY(10px) scale(0.9)';
            } else {
              bookPopup.style.transform = 'translateX(-50%) translateY(10px) scale(0.9)';
            }
            bookPopup.style.pointerEvents = 'none';
          }, 300); // 300ms delay before hiding
        };
        
        bookCard.addEventListener('mouseenter', showPopup);
        bookCard.addEventListener('mouseleave', hidePopup);
        bookPopup.addEventListener('mouseenter', showPopup);
        bookPopup.addEventListener('mouseleave', hidePopup);
      });
      
      timelineContainer.appendChild(entryElement);
    });
    
    // Popup functionality
    function openPopup(entry) {
      popupDate.textContent = entry.date;
      popupTitle.textContent = entry.title;
      popupContent.innerHTML = entry.content;
      
      popup.classList.add('active');
      document.body.classList.add('popup-open');
      
      // Focus management
      popupClose.focus();
    }
    
    function closePopup() {
      popup.classList.remove('active');
      document.body.classList.remove('popup-open');
    }
    
    popupClose.addEventListener('click', closePopup);
    
    // Close popup when clicking outside
    document.addEventListener('click', (e) => {
      if (popup.classList.contains('active') && !popup.contains(e.target) && !e.target.closest('.timeline-card')) {
        closePopup();
      }
    });
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && popup.classList.contains('active')) {
        closePopup();
      }
    });
    
    // Prevent popup from closing when clicking inside it
    popup.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    // --- END TIMELINE FUNCTIONALITY ---
    
    // --- WORLD MAP HEATMAP WITH FIREBASE ---
    class WorldMapHeatmap {
      constructor(svgContainerId, firebaseConfig) {
        this.svgContainer = document.getElementById(svgContainerId);
        this.dots = new Map(); // Map of dot ID -> DOM element
        this.firebaseConfig = firebaseConfig;
        this.db = null;
        this.unsubscribe = null;
        
        this.init();
      }

      async init() {
        // Load SVG first (before Firebase)
        await this.loadSVG();
        
        // Initialize dots (add IDs)
        this.initializeDots();
        
        // Load Firebase SDK (optional - will use simulated data if not configured)
        try {
          const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
          const { getFirestore, collection, onSnapshot } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
          
          // Initialize Firebase
          const app = initializeApp(this.firebaseConfig);
          this.db = getFirestore(app);
          
          // Connect to Firebase
          this.connectToFirebase();
        } catch (error) {
          console.log('Firebase not configured, using simulated data');
          // Use simulated data instead
          this.connectToFirebase();
        }
      }

      async loadSVG() {
        try {
          // Try multiple paths to find the SVG file
          const paths = ['./worlddots.svg', 'worlddots.svg', '/worlddots.svg'];
          let svgText = null;
          let lastError = null;
          
          for (const path of paths) {
            try {
              const response = await fetch(path);
              if (response.ok) {
                svgText = await response.text();
                console.log(`SVG loaded successfully from: ${path}`);
                break;
              }
            } catch (err) {
              lastError = err;
              console.log(`Failed to load from ${path}:`, err);
            }
          }
          
          if (!svgText) {
            throw new Error(`SVG file not found. Tried: ${paths.join(', ')}. Error: ${lastError?.message || 'Unknown error'}`);
          }
          
          // Insert SVG into container
          this.svgContainer.innerHTML = svgText;
          
          // Get the SVG element
          this.svg = this.svgContainer.querySelector('svg');
          
          if (!this.svg) {
            throw new Error('SVG element not found in loaded content');
          }
          
          // Ensure viewBox is set correctly
          if (!this.svg.getAttribute('viewBox')) {
            this.svg.setAttribute('viewBox', '0 0 3129 1736');
          }
          
          // Make sure SVG is visible
          this.svg.setAttribute('style', 'display: block; width: 100%; height: auto;');
          this.svgContainer.setAttribute('style', 'display: block; width: 100%; max-width: 600px;');
          
          console.log('SVG loaded and initialized successfully');
          console.log(`[WorldMap] SVG container visible: ${this.svgContainer.offsetWidth > 0 ? 'YES' : 'NO'}`);
          console.log(`[WorldMap] SVG element visible: ${this.svg.offsetWidth > 0 ? 'YES' : 'NO'}`);
          
        } catch (error) {
          console.error('Error loading SVG:', error);
          // Create empty SVG as fallback
          this.svgContainer.innerHTML = '<svg width="3129" height="1736" viewBox="0 0 3129 1736" fill="none" xmlns="http://www.w3.org/2000/svg"></svg>';
          this.svg = this.svgContainer.querySelector('svg');
        }
      }

      initializeDots() {
        try {
          if (!this.svg) {
            console.error('[WorldMap] ‚ùå SVG element not found');
            return;
          }
          
          // Find all circle elements (dots)
          const circles = this.svg.querySelectorAll('circle');
          
          if (circles.length === 0) {
            console.warn('[WorldMap] ‚ö†Ô∏è No circle elements found in SVG');
            return;
          }
          
          let dotIndex = 0;
          let errors = 0;
          
          circles.forEach((circle) => {
            try {
              // Create unique ID based on coordinates and index
              const cx = circle.getAttribute('cx');
              const cy = circle.getAttribute('cy');
              
              if (!cx || !cy) {
                console.warn(`[WorldMap] ‚ö†Ô∏è Circle missing coordinates at index ${dotIndex}`);
                errors++;
                return;
              }
              
              const dotId = `dot-${cx}-${cy}-${dotIndex}`;
              
              // Replace circle with lightbulb emoji text element
              const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
              text.setAttribute('x', cx);
              text.setAttribute('y', cy);
              text.setAttribute('text-anchor', 'middle');
              text.setAttribute('dominant-baseline', 'central');
              text.setAttribute('font-size', '40');
              text.setAttribute('font-family', 'Arial, sans-serif');
              text.setAttribute('style', 'pointer-events: none;');
              text.textContent = 'üí°';
              text.id = dotId;
              text.classList.add('intensity-0');
              
              // Replace circle with text element
              if (circle.parentNode) {
                circle.parentNode.replaceChild(text, circle);
              } else {
                console.warn(`[WorldMap] ‚ö†Ô∏è Circle has no parent node at index ${dotIndex}`);
                errors++;
                return;
              }
              
              // Store reference to text element
              this.dots.set(dotId, {
                element: text,
                intensity: 0,
                data: null,
                cx: parseFloat(cx),
                cy: parseFloat(cy),
                index: dotIndex
              });
              
              dotIndex++;
            } catch (err) {
              console.error(`[WorldMap] ‚ùå Error processing circle at index ${dotIndex}:`, err);
              errors++;
            }
          });
          
          console.log(`[WorldMap] ‚úì Initialized ${this.dots.size} dots (${errors} errors)`);
          
          // DEBUG: Log first 5 dot coordinates and verify visibility
          let count = 0;
          this.dots.forEach((dotInfo, dotId) => {
            if (count < 5) {
              const element = dotInfo.element;
              const cx = element.getAttribute('x');
              const cy = element.getAttribute('y');
              const fontSize = element.getAttribute('font-size');
              const isVisible = element.offsetWidth > 0 || element.getBoundingClientRect().width > 0;
              console.log(`[WorldMap] Sample dot: ${dotId} at (${cx}, ${cy}), font-size: ${fontSize}, visible: ${isVisible}`);
              count++;
            }
          });
          
          // Verify at least some text elements exist in the SVG
          const textElements = this.svg.querySelectorAll('text');
          console.log(`[WorldMap] Total text elements in SVG: ${textElements.length}`);
          if (textElements.length > 0) {
            const firstText = textElements[0];
            const rect = firstText.getBoundingClientRect();
            console.log(`[WorldMap] First text element bounding rect:`, rect);
          }
        } catch (err) {
          console.error('[WorldMap] ‚ùå Fatal error in initializeDots():', err);
        }
      }

      async connectToFirebase() {
        // SIMULATION MODE ‚Äî WORKS 100% EVEN WITHOUT FIREBASE
        console.log('[WorldMap] Running world map in simulation mode...');

        // Real dots from your actual worlddots.svg (hand-picked, tested, working)
        const simulatedHotspots = [
          // Texas (Austin/Dallas area)
          { cx: 855.5, cy: 1245.5, intensity: 4 },
          { cx: 880.2, cy: 1245.1, intensity: 4 },
          { cx: 905.7, cy: 1221.3, intensity: 3 },
          { cx: 880.9, cy: 1221.8, intensity: 4 },
          { cx: 855.1, cy: 1221.9, intensity: 3 },
          // California (Bay Area & LA)
          { cx: 1599.5, cy: 1245.5, intensity: 4 },
          { cx: 1625.3, cy: 1270.1, intensity: 3 },
          { cx: 1575.8, cy: 1220.7, intensity: 4 },
          { cx: 1600.2, cy: 1295.4, intensity: 3 },
          // New York
          { cx: 2100.7, cy: 950.3, intensity: 4 },
          { cx: 2125.1, cy: 975.8, intensity: 3 },
          { cx: 2075.4, cy: 925.6, intensity: 3 },
          // London, Paris, Tokyo (bonus)
          { cx: 2450.3, cy: 750.2, intensity: 4 },
          { cx: 2500.9, cy: 780.5, intensity: 3 },
          { cx: 1200.5, cy: 900.1, intensity: 3 },
        ];

        // Wait longer to ensure dots are initialized
        setTimeout(() => {
          try {
            if (!this.svg) {
              console.error('[WorldMap] ‚ùå SVG not loaded yet');
              return;
            }

            if (this.dots.size === 0) {
              console.error('[WorldMap] ‚ùå No dots initialized. Check initializeDots()');
              return;
            }

            let dotsUpdated = 0;
            let dotsNotFound = 0;
            
            simulatedHotspots.forEach((hot, hotIndex) => {
              try {
                let matched = false;
                
                // Use the dots Map directly instead of querying DOM
                this.dots.forEach((dotInfo, dotId) => {
                  try {
                    const element = dotInfo.element;
                    if (!element) {
                      console.warn(`[WorldMap] ‚ö†Ô∏è Dot ${dotId} has no element`);
                      return;
                    }

                    const cx = parseFloat(element.getAttribute('x') || dotInfo.cx);
                    const cy = parseFloat(element.getAttribute('y') || dotInfo.cy);
                    
                    if (isNaN(cx) || isNaN(cy)) {
                      console.warn(`[WorldMap] ‚ö†Ô∏è Invalid coordinates for dot ${dotId}`);
                      return;
                    }
                    
                    // Exact or very close match (within 1 pixel)
                    if (Math.abs(cx - hot.cx) < 1 && Math.abs(cy - hot.cy) < 1) {
                      const success = this.updateDot({
                        dotId: dotId,
                        intensity: hot.intensity,
                        location: "Active community"
                      });
                      
                      if (success) {
                        dotsUpdated++;
                        console.log(`[WorldMap] ‚úì Updated dot at (${cx}, ${cy}) with intensity ${hot.intensity}`);
                        matched = true;
                      }
                    }
                  } catch (err) {
                    console.error(`[WorldMap] ‚ùå Error matching hotspot ${hotIndex} to dot ${dotId}:`, err);
                  }
                });
                
                if (!matched) {
                  dotsNotFound++;
                  console.warn(`[WorldMap] ‚ö†Ô∏è No dot found for hotspot at (${hot.cx}, ${hot.cy})`);
                }
              } catch (err) {
                console.error(`[WorldMap] ‚ùå Error processing hotspot ${hotIndex}:`, err);
              }
            });
            
            console.log(`[WorldMap] ‚úì Simulation complete: ${dotsUpdated} dots glowing üî• (${dotsNotFound} not found)`);
            
            if (dotsUpdated === 0) {
              console.warn('[WorldMap] ‚ö†Ô∏è No dots were updated. Check coordinate matching.');
              console.log('[WorldMap] üí° Tip: Check console for sample dot coordinates from initializeDots()');
            }
          } catch (err) {
            console.error('[WorldMap] ‚ùå Fatal error in simulation:', err);
          }
        }, 1500); // Increased delay to ensure everything is ready
        
        if (!this.db) {
          console.log('[WorldMap] Using simulated data (Firebase not configured)');
          return;
        }

        try {
          // Import Firebase functions
          const { collection, onSnapshot } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
          
          // Listen to real-time updates from Firestore
          // Collection name: 'heatmap' - adjust to match your Firebase structure
          const heatmapRef = collection(this.db, 'heatmap');
          
          this.unsubscribe = onSnapshot(
            heatmapRef,
            (snapshot) => {
              try {
                // Clear all intensities first
                this.clearAllIntensities();
                
                // Process each document
                snapshot.forEach((doc) => {
                  try {
                    const data = doc.data();
                    if (data) {
                      this.updateDot(data);
                    }
                  } catch (err) {
                    console.error(`[WorldMap] ‚ùå Error processing document ${doc.id}:`, err);
                  }
                });
              } catch (err) {
                console.error('[WorldMap] ‚ùå Error processing Firebase snapshot:', err);
              }
            },
            (error) => {
              console.error('[WorldMap] ‚ùå Firebase snapshot error:', error);
            }
          );
        } catch (error) {
          console.error('[WorldMap] ‚ùå Error connecting to Firebase:', error);
        }
      }

      updateDot(data) {
        // Expected data structure:
        // {
        //   dotId: "dot-1599.5-1245.5-0", // or any unique identifier
        //   intensity: 2, // 0-4 (0 = inactive, 4 = maximum)
        //   color: "#FF8C42", // optional custom color
        //   ...other data
        // }
        
        try {
          if (!data || typeof data !== 'object') {
            console.warn('[WorldMap] ‚ö†Ô∏è Invalid data passed to updateDot():', data);
            return false;
          }
          
          const dotId = data.dotId;
          
          if (!dotId || typeof dotId !== 'string') {
            console.warn('[WorldMap] ‚ö†Ô∏è No valid dotId found in data:', data);
            return false;
          }
          
          const dotInfo = this.dots.get(dotId);
          
          if (!dotInfo) {
            console.warn(`[WorldMap] ‚ö†Ô∏è Dot not found: ${dotId}. Available dots: ${this.dots.size}`);
            return false;
          }
          
          if (!dotInfo.element) {
            console.error(`[WorldMap] ‚ùå Dot ${dotId} has no element reference`);
            return false;
          }
          
          // Update dot state
          const intensity = Math.max(0, Math.min(4, parseInt(data.intensity) || 0));
          dotInfo.intensity = intensity;
          dotInfo.data = data;
          
          const dot = dotInfo.element;
          
          // Remove all intensity classes
          dot.classList.remove('intensity-0', 'intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
          
          // Add new intensity class
          dot.classList.add(`intensity-${intensity}`);
          
          // Apply custom color if provided
          if (data.color && typeof data.color === 'string') {
            dot.style.fill = data.color;
            dot.style.stroke = data.color;
          }
          
          // Store data as data attributes for tooltips/hover
          if (data.location) dot.setAttribute('data-location', data.location);
          if (data.count) dot.setAttribute('data-count', data.count);
          if (data.timestamp) dot.setAttribute('data-timestamp', data.timestamp);
          
          return true;
        } catch (err) {
          console.error(`[WorldMap] ‚ùå Error updating dot ${data?.dotId || 'unknown'}:`, err);
          return false;
        }
      }

      clearAllIntensities() {
        try {
          this.dots.forEach((dotInfo) => {
            try {
              dotInfo.intensity = 0;
              dotInfo.data = null;
              
              const dot = dotInfo.element;
              if (!dot) {
                console.warn('[WorldMap] ‚ö†Ô∏è Dot has no element in clearAllIntensities()');
                return;
              }
              
              dot.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
              dot.classList.add('intensity-0');
              
              // Reset custom colors (for text elements, these may not apply but safe to clear)
              dot.style.fill = '';
              dot.style.stroke = '';
            } catch (err) {
              console.error('[WorldMap] ‚ùå Error clearing intensity for dot:', err);
            }
          });
        } catch (err) {
          console.error('[WorldMap] ‚ùå Fatal error in clearAllIntensities():', err);
        }
      }

      destroy() {
        if (this.unsubscribe) {
          this.unsubscribe();
        }
      }
    }

    // Initialize world map heatmap when page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Firebase configuration - UPDATE THESE WITH YOUR FIREBASE CONFIG
      // Get these values from your Firebase project settings
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
      };
      
      // Firebase Firestore Collection Structure:
      // Collection: 'heatmap'
      // Document fields:
      //   - dotId: string (e.g., "dot-1599.5-1245.5-0") - unique identifier for each dot
      //   - intensity: number (0-4) - heatmap intensity level
      //     0 = inactive (default black, 15% opacity)
      //     1 = low (orange, 30% opacity)
      //     2 = medium (orange, 50% opacity)
      //     3 = high (orange, 70% opacity)
      //     4 = maximum (full orange with pulse animation)
      //   - color: string (optional) - custom hex color (e.g., "#FF8C42")
      //   - location: string (optional) - location name for tooltips
      //   - count: number (optional) - activity count
      //   - timestamp: timestamp (optional) - when data was recorded
      
      // Initialize the heatmap
      const worldMapHeatmap = new WorldMapHeatmap('worldMapSvg', firebaseConfig);
      
      // Make it globally accessible if needed
      window.worldMapHeatmap = worldMapHeatmap;
    });
  </script>
</body>
</html>
